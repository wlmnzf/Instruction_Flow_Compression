# Makefile generated by build.

# C compiler
#CC=cc

# Install prefix
DESTDIR=

# Base install directory
PREFIX=/usr/local

# Install directory for binaries
BINDIR=$(PREFIX)/bin

# Install directory for manual
MANDIR=$(PREFIX)/share/man/man1

# compiler options:
# options is a collection of:
#
#	-DAMIGA=1					Amiga support.
#	-DLSTAT=1					Use lstat for finding symlinks.
#	-DUTIME_H=1					Use utime.h
#	-DUSERMEM=<size>			Available memory for compress (default 800k).
#	-DIBUFSIZ=<size>			Input buffer size (default BUFSIZ).
#	-DOBUFSIZ=<size>			Output buffer size (default BUFSIZ)
#	-DBYTEORDER=<order>			Byte order (default: unknown).
#	-DMAXSEG_64K=1 -BITS=16		Support segment processor like 80286.
#
options= -DUTIME_H -DLSTAT $(CFLAGS) $(CPPFLAGS) -DUSERMEM=800000

# library options
LBOPT= $(LDFLAGS)


compress:	Makefile compress.c patchlevel.h
	$(CC) -o compress $(options) compress.c $(LBOPT)

install_core:	compress
		[ -f $(DESTDIR)$(BINDIR)/compress ] && \
			{ rm -f $(DESTDIR)$(BINDIR)/compress.old ; \
	  		mv $(DESTDIR)$(BINDIR)/compress $(DESTDIR)$(BINDIR)/compress.old ; } || :
		rm -f $(DESTDIR)$(BINDIR)/uncompress $(DESTDIR)$(BINDIR)/zcat
		mkdir -p $(DESTDIR)$(BINDIR) $(DESTDIR)$(MANDIR)
		cp compress $(DESTDIR)$(BINDIR)/compress
		rm -f $(DESTDIR)$(BINDIR)/uncompress
		ln $(DESTDIR)$(BINDIR)/compress $(DESTDIR)$(BINDIR)/uncompress
		cp compress.1 uncompress.1 $(DESTDIR)$(MANDIR)/.
		chmod 0644 $(DESTDIR)$(MANDIR)/compress.1 $(DESTDIR)$(MANDIR)/uncompress.1

install_extra: install_core
		mkdir -p $(DESTDIR)$(BINDIR) $(DESTDIR)$(MANDIR)
		rm -f $(DESTDIR)$(BINDIR)/zcat
		ln -f $(DESTDIR)$(BINDIR)/compress $(DESTDIR)$(BINDIR)/zcat
		cp zcmp zdiff zmore $(DESTDIR)$(BINDIR)/.
		chmod 0755 $(DESTDIR)$(BINDIR)/compress $(DESTDIR)$(BINDIR)/zcmp $(DESTDIR)$(BINDIR)/zdiff $(DESTDIR)$(BINDIR)/zmore
		cp zcmp.1 zmore.1 $(DESTDIR)$(MANDIR)/.
		chmod 0644 $(DESTDIR)$(MANDIR)/zcmp.1 $(DESTDIR)$(MANDIR)/zmore.1

install: install_extra

cleanup:
		rm -f compress compress.def comp.log
